<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<title>How To Use Facebook Page Albums As Image Source in Django &#8211; </title>
<meta name="description" content="A guide to your Digitial Life.">
<meta name="keywords" content="">
<!-- Twitter Card and Open Graph tags -->
<meta name="twitter:title" content="How To Use Facebook Page Albums As Image Source in Django &#8211; ">
<meta name="twitter:description" content="A guide to your Digitial Life.">
<meta name="twitter:creator" content="@vinitkme">
<meta name="twitter:card" content="summary">
<meta name="twitter:image:src" content="/images/logo.png">
<meta property="og:type" content="article">
<meta property="og:title" content="How To Use Facebook Page Albums As Image Source in Django &#8211; ">
<meta property="og:description" content="A guide to your Digitial Life.">
<meta property="og:url" content="/2014/02/14/how-to-use-facebook-page-albums-as-image-source-in-django.html">
<meta property="og:site_name" content="">

<!-- Webmaster Tools verfication -->




<link rel="canonical" href="/2014/02/14/how-to-use-facebook-page-albums-as-image-source-in-django.html">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link rel="author" href="+Vinitkumarme?rel=author">


  <title>
      
  </title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/css/base.css" type="text/css" />

</head>
<body>
  <div class="header-container">
  <header>
      <ul class="nav">
        <li><a href="/">Gotchacode</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/code">Code</a></li>
      </ul>
  </header>
</div>
  <div class="container">
    <p class="intro">
      My name is <a href="http://vinitkumar.me">Vinit Kumar</a> and I work at <a href="https://changer.nl">Changer</a> in Pune. I love to solve hard problems and write beautiful code..
    </p>
  <h2>How To Use Facebook Page Albums As Image Source in Django</h2>
<p class="meta">14 Feb 2014</p>

<div class="post">
<p>Lot of companies use Facebook for marketing their products. Facebook is mainly built around images. In fact the whole ecosystem is fueled by images. In order to scale for the vast user base of Facebook, they have done a really good job. </p>

<p>So what if you don&#39;t want to use your own storage for uploading images and want to use Facebook for Images? It would be so cool, right?
There are two benefits:</p>

<ul>
<li>You don&#39;t have to spend anytime setting up an app or service to deal with images. Believe me it is a real tough problem to solve given the size and count of images. You can&#39;t put a bar on either of these two.</li>
<li>It gives your users a much user friendly way. They upload images just once on Facebook and it auto-magically appears on your website. Facebook almost never gets down so there is very good chance you will get a 99.9% uptime. </li>
</ul>

<p>So, In order to fix this problem last year I created a Ajax based plugins to fetch images from Facebook album. It asked user to enter album URL and name. But there was an issue with this approach. In order to get access to Facebook graph database it has to get access tokens and each access token only last two months. Plus, it collapsed when it faced IE, since there is unsolvable CORS issue with IE &lt; 9 (our 50% client base for that project).</p>

<p>It was a tough problem to solve. But i finally found some good articles and projects on Internet. One such project was django-fbgallery. It used a really neat approach to get the Facebook images server side and renders it the page purely server side. It not only solved the IE issue, but also the quality and speed of image loading became instant.</p>

<p>But there was an issue with this app, it used URLS to render the albums and spoiled the pretty URLS that you would like for pages in Django. So I took the core part of the app ( the Facebook interaction part) and made a sweet CMS plugin out of it. </p>

<p>Here is the code to make it all work:</p>

<p>```python Facebook.py 
from django.conf import settings
from django.core.cache import cache
import urllib2, urllib
import django.utils.simplejson as json
from django.template import defaultfilters</p>

<p>fql<em>url = &#39;https://api.Facebook.com/method/fql.query&#39;
cache</em>expires = getattr(settings, &#39;CACHE_EXPIRES&#39;, 30)</p>

<p>def get<em>fql</em>result(fql):
    cachename = &#39;fbgallery<em>cache</em>&#39; + defaultfilters.slugify(fql)
    data = None
    if cache<em>expires &gt; 0:
        data = cache.get(cachename)
    if data == None: 
        options = {
            &#39;query&#39;:fql,
            &#39;format&#39;:&#39;json&#39;,
        }
        f = urllib2.urlopen(urllib2.Request(fql</em>url, urllib.urlencode(options)))
        response = f.read()
        f.close()<br>
        data = json.loads(response)
        if cache<em>expires &gt; 0:
            cache.set(cachename, data, cache</em>expires*60)
    return data</p>

<p>def display<em>album(album</em>id):
    &quot;&quot;&quot;Display a Facebook album</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">First check that the album id belongs to the page id specified
&quot;&quot;&quot;
fb_id = settings.FB_PAGE_ID
fql = &quot;select aid, name from album where owner=%s and aid=&#39;%s&#39;&quot; % (fb_id, album_id)
valid_album = get_fql_result(fql)
if valid_album:
    fql = &quot;select pid, src, src_small, src_big, caption from photo where aid = &#39;%s&#39;  order by created desc&quot; % album_id
    album = get_fql_result(fql)
    #album_detail = [item for item in valid_album]       
    return album
</code></pre></div><div class="highlight"><pre><code class="text language-text" data-lang="text">I asked user to enter the album ID and name, then rendered the album using the plugin here:


```python cms_plugins.py 
from cms.plugin_base import CMSPluginBase
from cms.plugin_pool import plugin_pool
from django.utils.translation import ugettext_lazy as _
from Facebook import display_album

from models import FacebookGallery

class FacebookGalleryPlugin(CMSPluginBase):
    model = FacebookGallery
    name = _(&quot;Facebook Album Gallery&quot;)
    render_template = &quot;cmsplugin_fbgallery/album.html&quot;

    def render(self, context, instance, placeholder):
        album = display_album(instance.album_id)
        context.update({
          &#39;object&#39;: instance,
          &#39;album&#39;: album,
          })
        return context

plugin_pool.register_plugin(FacebookGalleryPlugin)
</code></pre></div>
<p>You could choose whatever template you want. It&#39;s entirely upto you.  </p>

<p>Here is the image of this plugin live in action: </p>

<p><a href="http://imgur.com/dmrxcXh"><img src="http://i.imgur.com/dmrxcXh.png" title="Hosted by imgur.com" /></a></p>

<p>The plugin is open sourced here: <a href="https://github.com/changer/cmsplugin-fbgallery">cmsplugin-fbgallery</a> . Feel free to contribute and ask questions.</p>

</div>

<div class="keep-in-touch">
  <p>
    Tweet me <a href="https://twitter.com/vinitkme">@vinitkme</a> if you like this post.
</div>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'gotchacode'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  

<script async type="text/javascript" charset="utf-8" src="/js/ga.js"></script>

  </div><!-- /.main -->
</body>
</html>